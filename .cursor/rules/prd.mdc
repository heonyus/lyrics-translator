# ê°€ë¼ì˜¤ì¼€ ìŠ¤íƒ€ì¼ ê°€ì‚¬ ë²ˆì—­ ì‹œìŠ¤í…œ PRD (ìë™ LRC íŒŒì´í”„ë¼ì¸)

## 1. í”„ë¡œì íŠ¸ ê°œìš”

- **í”„ë¡œì íŠ¸ ëª…**: Lyrics Translator - ì‹¤ì‹œê°„ ê°€ë¼ì˜¤ì¼€ ê°€ì‚¬ ë²ˆì—­ê¸°
- **ëª©í‘œ**: ë…¸ë˜ ë°©ì†¡ì—ì„œ ê°€ë¼ì˜¤ì¼€ ìŠ¤íƒ€ì¼ë¡œ ê°€ì‚¬ë¥¼ ë‹¨ì–´ë³„ë¡œ í•˜ì´ë¼ì´íŒ…í•˜ë©° ì‹¤ì‹œê°„ ë²ˆì—­ì„ í‘œì‹œí•˜ëŠ” OBS ì˜¤ë²„ë ˆì´ ì‹œìŠ¤í…œ. ìˆ˜ë™ ì—…ë¡œë“œ ì—†ì´ ìë™ìœ¼ë¡œ LRC íŒŒì¼ì„ ê²€ìƒ‰/ë‹¤ìš´ë¡œë“œí•˜ê³  íƒ€ì´ë°ì„ ë™ê¸°í™”í•œë‹¤.
- **í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ**: Next.js 15, TypeScript, React 19, Framer Motion, Google Translate API, OBS Browser Source

## 2. í•µì‹¬ ê¸°ëŠ¥ (Features)

- **ìë™ LRC ê²€ìƒ‰ íŒŒì´í”„ë¼ì¸**:
  - ê³¡ëª…/ì•„í‹°ìŠ¤íŠ¸ë¡œ ìë™ LRC ê²€ìƒ‰ (Spotify, Genius, Musixmatch ë“±)
  - YouTube Music/Spotify URL ì…ë ¥ ì‹œ ë©”íƒ€ë°ì´í„° ìë™ ì¶”ì¶œ
  - ë‹¤ì–‘í•œ LRC ì†ŒìŠ¤ì—ì„œ ìˆœì°¨ì  ê²€ìƒ‰ ë° í’ˆì§ˆ ë¹„êµ
  - AI ê¸°ë°˜ ê°€ì‚¬ íƒ€ì´ë° ìƒì„± (LRC ì—†ì„ ì‹œ í´ë°±)

- **ê°€ë¼ì˜¤ì¼€ ìŠ¤íƒ€ì¼ ë””ìŠ¤í”Œë ˆì´**:
  - ë‹¨ì–´ë³„ ì‹¤ì‹œê°„ í•˜ì´ë¼ì´íŒ… ì• ë‹ˆë©”ì´ì…˜
  - ë¶€ë“œëŸ¬ìš´ ì§„í–‰ë¥  í‘œì‹œ ë° ìƒ‰ìƒ ì „í™˜
  - í˜„ì¬ ì¤„ ê°•ì¡° ë° ë‹¤ìŒ ì¤„ ë¯¸ë¦¬ë³´ê¸°
  - ì»¤ìŠ¤í„°ë§ˆì´ì§• ê°€ëŠ¥í•œ í°íŠ¸, ìƒ‰ìƒ, ì• ë‹ˆë©”ì´ì…˜

- **ì‹¤ì‹œê°„ ë²ˆì—­ ì‹œìŠ¤í…œ**:
  - ê°€ì‚¬ ì¤„ ë‹¨ìœ„ ì‹¤ì‹œê°„ ë²ˆì—­ (Google Translate API)
  - ë‹¤êµ­ì–´ ë™ì‹œ í‘œì‹œ ì§€ì›
  - ë²ˆì—­ ìºì‹±ìœ¼ë¡œ API í˜¸ì¶œ ìµœì í™”
  - ì–¸ì–´ë³„ í°íŠ¸ ë° í¬ê¸° ìë™ ì¡°ì ˆ

- **ë™ê¸°í™” ë° ì¡°ì • ê¸°ëŠ¥**:
  - ì‹¤ì‹œê°„ íƒ€ì´ë° ì˜¤í”„ì…‹ ì¡°ì • (Â±)
  - ì˜¤ë””ì˜¤ íŒŒí˜• ì‹œê°í™”ì™€ ê°€ì‚¬ ë™ê¸°í™”
  - ìˆ˜ë™ íƒ€ì´ë° ì—ë””í„° (êµ¬ê°„ë³„ ë¯¸ì„¸ ì¡°ì •)
  - ë™ê¸°í™” í”„ë¦¬ì…‹ ì €ì¥ ë° ê³µìœ 

- **OBS í†µí•©**:
  - íˆ¬ëª… ë°°ê²½ ë¸Œë¼ìš°ì € ì†ŒìŠ¤
  - ì‹¤ì‹œê°„ ì»¨íŠ¸ë¡¤ íŒ¨ë„ (ë³„ë„ ì°½)
  - ë‹¨ì¶•í‚¤ ì§€ì› (ì¬ìƒ/ì •ì§€, ì˜¤í”„ì…‹ ì¡°ì •)
  - ë‹¤ì–‘í•œ ì˜¤ë²„ë ˆì´ í…œí”Œë¦¿

## 3. IA (í˜ì´ì§€ êµ¬ì¡°ë„)

- **ì»¨íŠ¸ë¡¤ íŒ¨ë„ (`/`)**:
  - ê³¡ ê²€ìƒ‰ ë° ìë™ LRC ë‹¤ìš´ë¡œë“œ
  - ì¬ìƒ ì»¨íŠ¸ë¡¤ ë° íƒ€ì´ë° ì¡°ì •
  - ë²ˆì—­ ì–¸ì–´ ì„ íƒ ë° ì„¤ì •
  - ì˜¤ë²„ë ˆì´ ìŠ¤íƒ€ì¼ ì»¤ìŠ¤í„°ë§ˆì´ì§•

- **OBS ì˜¤ë²„ë ˆì´ (`/overlay`)**:
  - íˆ¬ëª… ë°°ê²½ ê°€ë¼ì˜¤ì¼€ ë””ìŠ¤í”Œë ˆì´
  - ì‹¤ì‹œê°„ ê°€ì‚¬ í•˜ì´ë¼ì´íŒ…
  - ë²ˆì—­ë¬¸ ë™ì‹œ í‘œì‹œ
  - URL íŒŒë¼ë¯¸í„°ë¡œ ì„¤ì • ì œì–´

- **ì„¤ì • í˜ì´ì§€ (`/settings`)**:
  - API í‚¤ ê´€ë¦¬ (Google Translate ë“±)
  - LRC ì†ŒìŠ¤ ìš°ì„ ìˆœìœ„ ì„¤ì •
  - ê¸°ë³¸ ìŠ¤íƒ€ì¼ í…Œë§ˆ ì €ì¥
  - ë™ê¸°í™” í”„ë¦¬ì…‹ ê´€ë¦¬

## 4. ë„ë©”ì¸ ì„¤ê³„

`src/domains/` ê¸°ì¤€ìœ¼ë¡œ êµ¬ì„±

- `lyrics`: LRC íŒŒì‹±, íƒ€ì´ë° ê´€ë¦¬, ê°€ì‚¬ ë°ì´í„° ì²˜ë¦¬
- `lrc-fetcher`: ìë™ LRC ê²€ìƒ‰ ë° ë‹¤ìš´ë¡œë“œ íŒŒì´í”„ë¼ì¸
- `metadata`: ê³¡ ì •ë³´ ì¶”ì¶œ (YouTube, Spotify API)
- `karaoke`: ê°€ë¼ì˜¤ì¼€ ë Œë”ë§, ë‹¨ì–´ í•˜ì´ë¼ì´íŒ…, ì• ë‹ˆë©”ì´ì…˜
- `translation`: ì‹¤ì‹œê°„ ë²ˆì—­ ì²˜ë¦¬, ìºì‹±, ë‹¤êµ­ì–´ ì§€ì›
- `sync`: íƒ€ì´ë° ë™ê¸°í™”, ì˜¤í”„ì…‹ ì¡°ì •, ìˆ˜ë™ ì—ë””í„°
- `overlay`: OBS ì˜¤ë²„ë ˆì´ ë Œë”ë§, íˆ¬ëª…ë„ ì²˜ë¦¬
- `settings`: ì‚¬ìš©ì ì„¤ì •, API í‚¤, ìŠ¤íƒ€ì¼ í…Œë§ˆ ê´€ë¦¬
- `ui`: ì»¨íŠ¸ë¡¤ íŒ¨ë„, ê²€ìƒ‰ UI, ì„¤ì • ì»´í¬ë„ŒíŠ¸

## 5. ìë™ LRC íŒŒì´í”„ë¼ì¸ ì„¤ê³„

### 5.1 LRC ì†ŒìŠ¤ í”„ë¡œë°”ì´ë”

```typescript
// LRC ì œê³µì ì¸í„°í˜ì´ìŠ¤
interface LRCProvider {
  name: string;
  priority: number;
  searchLRC(query: SongQuery): Promise<LRCSearchResult[]>;
  fetchLRC(lrcId: string): Promise<string>;
  confidence: number; // 0-1, ì‹ ë¢°ë„
}

// ê²€ìƒ‰ ì¿¼ë¦¬
interface SongQuery {
  title: string;
  artist: string;
  album?: string;
  duration?: number;
  isrc?: string; // International Standard Recording Code
  spotifyId?: string;
  youtubeId?: string;
}
```

### 5.2 í”„ë¡œë°”ì´ë” êµ¬í˜„ì²´

1. **Spotify Lyrics API** (ë¹„ê³µì‹)
   - Spotify ì›¹ í”Œë ˆì´ì–´ì˜ ê°€ì‚¬ API í™œìš©
   - ë†’ì€ ì •í™•ë„, ê³µì‹ íƒ€ì´ë°
   - ë‹¨ì–´ë³„ íƒ€ì´ë° ì§€ì›

2. **Genius API**
   - ê°€ì‚¬ í…ìŠ¤íŠ¸ë§Œ ì œê³µ (íƒ€ì´ë° ì—†ìŒ)
   - AI íƒ€ì´ë° ìƒì„± í•„ìš”
   - ë©”íƒ€ë°ì´í„° í’ë¶€

3. **Musixmatch API**
   - ìƒì—…ìš© API (ìœ ë£Œ)
   - ì •í™•í•œ ì¤„ë³„ íƒ€ì´ë°
   - ë²ˆì—­ëœ ê°€ì‚¬ë„ ì œê³µ

4. **LRClib.net**
   - ë¬´ë£Œ ì˜¤í”ˆ ì†ŒìŠ¤
   - ì»¤ë®¤ë‹ˆí‹° ê¸°ë°˜ LRC
   - REST API ì œê³µ

5. **YouTube ìë§‰**
   - ìŒì•… ë¹„ë””ì˜¤ì˜ ìë§‰ ì¶”ì¶œ
   - íƒ€ì´ë° ì •í™•ë„ ë³€ë™
   - ytdl-core í™œìš©

### 5.3 íŒŒì´í”„ë¼ì¸ ë¡œì§

```pseudocode
// ìë™ LRC ê²€ìƒ‰ íŒŒì´í”„ë¼ì¸
async function autoFetchLRC(input: string | SongQuery): Promise<LRCResult> {
  // 1. ì…ë ¥ ë¶„ì„ ë° ë©”íƒ€ë°ì´í„° ì¶”ì¶œ
  songQuery = await extractMetadata(input)
  
  // 2. ë³‘ë ¬ë¡œ ëª¨ë“  í”„ë¡œë°”ì´ë” ê²€ìƒ‰
  const providers = [SpotifyProvider, MusixmatchProvider, LRClibProvider, ...]
  const searchPromises = providers.map(p => p.searchLRC(songQuery))
  const allResults = await Promise.allSettled(searchPromises)
  
  // 3. ê²°ê³¼ ì ìˆ˜ ê³„ì‚° ë° ì •ë ¬
  const scoredResults = calculateConfidence(allResults, songQuery)
  const bestResult = scoredResults[0]
  
  // 4. LRC ë‹¤ìš´ë¡œë“œ ë° ê²€ì¦
  if (bestResult.confidence > 0.8) {
    const lrcContent = await bestResult.provider.fetchLRC(bestResult.id)
    return { success: true, lrc: lrcContent, source: bestResult.provider.name }
  }
  
  // 5. í´ë°±: AI ê¸°ë°˜ íƒ€ì´ë° ìƒì„±
  if (bestResult.hasLyrics && !bestResult.hasTiming) {
    const timedLRC = await generateTimingWithAI(bestResult.lyrics, songQuery.duration)
    return { success: true, lrc: timedLRC, source: 'AI Generated' }
  }
  
  // 6. ìˆ˜ë™ ì…ë ¥ ìš”ì²­
  return { success: false, fallback: 'manual' }
}

// ë©”íƒ€ë°ì´í„° ì¶”ì¶œ
async function extractMetadata(input: string): Promise<SongQuery> {
  // URL íŒ¨í„´ ê²€ì‚¬
  if (isSpotifyURL(input)) {
    return await fetchSpotifyMetadata(extractSpotifyId(input))
  }
  if (isYouTubeURL(input)) {
    return await fetchYouTubeMetadata(extractYouTubeId(input))
  }
  
  // í…ìŠ¤íŠ¸ ê²€ìƒ‰ ì¿¼ë¦¬ íŒŒì‹±
  return parseSearchQuery(input) // "ì•„í‹°ìŠ¤íŠ¸ - ê³¡ëª…" í˜•ì‹ ë“±
}

// ì‹ ë¢°ë„ ì ìˆ˜ ê³„ì‚°
function calculateConfidence(results: LRCSearchResult[], query: SongQuery): ScoredResult[] {
  return results.map(result => {
    let score = result.provider.confidence
    
    // ì œëª© ì¼ì¹˜ë„
    score *= stringSimilarity(result.title, query.title)
    
    // ì•„í‹°ìŠ¤íŠ¸ ì¼ì¹˜ë„
    score *= stringSimilarity(result.artist, query.artist)
    
    // ì¬ìƒ ì‹œê°„ ì¼ì¹˜ë„ (Â±5ì´ˆ)
    if (query.duration && result.duration) {
      const timeDiff = Math.abs(query.duration - result.duration)
      score *= timeDiff < 5000 ? 1 : Math.max(0, 1 - timeDiff / 30000)
    }
    
    // ë‹¨ì–´ë³„ íƒ€ì´ë° ì—¬ë¶€
    score *= result.hasWordTiming ? 1.2 : 0.8
    
    return { ...result, confidence: score }
  }).sort((a, b) => b.confidence - a.confidence)
}

// AI íƒ€ì´ë° ìƒì„± (Whisper ë“± í™œìš©)
async function generateTimingWithAI(lyrics: string, audioDuration: number): Promise<string> {
  // 1. ì˜¤ë””ì˜¤ íŒŒì¼ í•„ìš” (YouTube ë“±ì—ì„œ ì¶”ì¶œ)
  const audioFile = await fetchAudioFile()
  
  // 2. Whisper APIë¡œ ìŒì„± ì¸ì‹ ë° íƒ€ì´ë° ì¶”ì¶œ
  const whisperResult = await whisperAPI.transcribe(audioFile, {
    language: 'auto',
    timestamps: 'word',
    prompt: lyrics // ê°€ì‚¬ë¥¼ í”„ë¡¬í”„íŠ¸ë¡œ ì œê³µí•˜ì—¬ ì •í™•ë„ í–¥ìƒ
  })
  
  // 3. ê°€ì‚¬ì™€ ì¸ì‹ ê²°ê³¼ ë§¤ì¹­
  const alignedLyrics = alignLyricsWithTranscription(lyrics, whisperResult)
  
  // 4. LRC í¬ë§·ìœ¼ë¡œ ë³€í™˜
  return convertToLRC(alignedLyrics)
}
```

## 6. ì£¼ìš” ì»´í¬ë„ŒíŠ¸ ì„¤ê³„

### 6.1 LRC Fetcher Manager
```typescript
class LRCFetcherManager {
  private providers: LRCProvider[] = [];
  private cache: Map<string, CachedLRC> = new Map();
  
  async searchSong(query: string): Promise<LRCSearchResult[]> {
    // ìºì‹œ í™•ì¸
    const cacheKey = this.generateCacheKey(query);
    if (this.cache.has(cacheKey)) {
      return this.cache.get(cacheKey)!.results;
    }
    
    // ë©”íƒ€ë°ì´í„° ì¶”ì¶œ
    const metadata = await this.extractMetadata(query);
    
    // ë³‘ë ¬ ê²€ìƒ‰
    const results = await this.searchAllProviders(metadata);
    
    // ìºì‹œ ì €ì¥
    this.cache.set(cacheKey, {
      results,
      timestamp: Date.now(),
      query: metadata
    });
    
    return results;
  }
  
  async downloadBestMatch(result: LRCSearchResult): Promise<ParsedLRC> {
    const lrcContent = await result.provider.fetchLRC(result.id);
    return this.parseLRC(lrcContent);
  }
}
```

### 6.2 ì‹¤ì‹œê°„ ë™ê¸°í™” ì‹œìŠ¤í…œ

```typescript
class SyncManager {
  private offset: number = 0; // ë°€ë¦¬ì´ˆ ë‹¨ìœ„ ì˜¤í”„ì…‹
  private playbackRate: number = 1.0;
  
  // ì‹¤ì‹œê°„ ì˜¤í”„ì…‹ ì¡°ì •
  adjustOffset(delta: number) {
    this.offset += delta;
    this.emit('offsetChanged', this.offset);
  }
  
  // í˜„ì¬ ì¬ìƒ ì‹œê°„ ê³„ì‚°
  getCurrentTime(audioTime: number): number {
    return (audioTime * this.playbackRate) + this.offset;
  }
  
  // ìë™ ë™ê¸°í™” (ì˜¤ë””ì˜¤ íŒŒí˜• ë¶„ì„)
  async autoSync(audioBuffer: AudioBuffer, lrcData: ParsedLRC) {
    // 1. ì˜¤ë””ì˜¤ì—ì„œ ë¹„íŠ¸/ìŒì„± onset ê²€ì¶œ
    const audioOnsets = this.detectOnsets(audioBuffer);
    
    // 2. LRCì˜ ì²« ë‹¨ì–´ íƒ€ì´ë°ê³¼ ë§¤ì¹­
    const lrcOnsets = lrcData.lines.map(line => line.words[0]?.startTime).filter(Boolean);
    
    // 3. ìµœì  ì˜¤í”„ì…‹ ê³„ì‚° (Dynamic Time Warping)
    this.offset = this.calculateOptimalOffset(audioOnsets, lrcOnsets);
  }
}
```

### 6.3 ê°€ë¼ì˜¤ì¼€ ë Œë”ëŸ¬
```typescript
interface KaraokeRenderer {
  currentLine: number;
  currentWord: number;
  progress: number; // 0-1
  
  render(currentTime: number): JSX.Element {
    const line = this.lrcData.lines[this.currentLine];
    const word = line.words[this.currentWord];
    
    return (
      <div className="karaoke-display">
        {/* ì´ì „ ì¤„ (í˜ì´ë“œ ì•„ì›ƒ) */}
        <div className="prev-line fade-out">
          {this.renderLine(this.currentLine - 1)}
        </div>
        
        {/* í˜„ì¬ ì¤„ (í•˜ì´ë¼ì´íŒ…) */}
        <div className="current-line">
          {line.words.map((w, i) => (
            <span 
              key={i}
              className={cn({
                'highlighted': i < this.currentWord,
                'highlighting': i === this.currentWord,
                'pending': i > this.currentWord
              })}
              style={{
                '--progress': i === this.currentWord ? this.progress : 0
              }}
            >
              {w.word}
            </span>
          ))}
        </div>
        
        {/* ë²ˆì—­ë¬¸ */}
        <div className="translation">
          {line.translation}
        </div>
        
        {/* ë‹¤ìŒ ì¤„ (í˜ì´ë“œ ì¸) */}
        <div className="next-line fade-in">
          {this.renderLine(this.currentLine + 1)}
        </div>
      </div>
    );
  }
}
```

## 7. API ì‚¬ìš© ë°©ì‹

### 7.1 LRC ì†ŒìŠ¤ APIë“¤

**Spotify (ë¹„ê³µì‹)**
```typescript
// Spotify Web APIì˜ ìˆ¨ê²¨ì§„ ì—”ë“œí¬ì¸íŠ¸ í™œìš©
const response = await fetch(`https://spclient.wg.spotify.com/color-lyrics/v2/track/${trackId}`, {
  headers: {
    'Authorization': `Bearer ${spotifyAccessToken}`,
    'app-platform': 'WebPlayer'
  }
});
```

**LRClib.net**
```typescript
// ë¬´ë£Œ ì˜¤í”ˆ API
const response = await fetch(`https://lrclib.net/api/search?q=${encodeURIComponent(query)}`);
const results = await response.json();
```

**Genius API**
```typescript
// ê°€ì‚¬ë§Œ ì œê³µ (íƒ€ì´ë° ì—†ìŒ)
const genius = new Genius(GENIUS_ACCESS_TOKEN);
const song = await genius.songs.search(query);
const lyrics = await genius.lyrics(song.id);
```

### 7.2 ë²ˆì—­ API

**Google Translate**
```typescript
const translate = new Translate({ key: GOOGLE_API_KEY });
const [translation] = await translate.translate(text, targetLang);
```

## 8. ìœ ì € í”Œë¡œìš° (Mermaid)

```mermaid
graph TD
    A[ë°©ì†¡ ì‹œì‘] --> B[ì»¨íŠ¸ë¡¤ íŒ¨ë„ ì—´ê¸°]
    B --> C{LRC ê²€ìƒ‰ ë°©ë²•}
    
    C -->|URL ì…ë ¥| D[YouTube/Spotify URL ë¶™ì—¬ë„£ê¸°]
    C -->|í…ìŠ¤íŠ¸ ê²€ìƒ‰| E[ì•„í‹°ìŠ¤íŠ¸ - ê³¡ëª… ì…ë ¥]
    C -->|ìˆ˜ë™ ì—…ë¡œë“œ| F[LRC íŒŒì¼ ì„ íƒ]
    
    D --> G[ë©”íƒ€ë°ì´í„° ìë™ ì¶”ì¶œ]
    E --> G
    G --> H[LRC ì†ŒìŠ¤ ë³‘ë ¬ ê²€ìƒ‰]
    
    H --> I[ê²€ìƒ‰ ê²°ê³¼ í‘œì‹œ]
    I --> J{ìµœì  ê²°ê³¼ ì„ íƒ}
    
    J -->|ìë™ ì„ íƒ| K[ì‹ ë¢°ë„ ë†’ì€ LRC ë‹¤ìš´ë¡œë“œ]
    J -->|ìˆ˜ë™ ì„ íƒ| L[ì‚¬ìš©ìê°€ ê²°ê³¼ ì„ íƒ]
    F --> M[LRC íŒŒì‹±]
    K --> M
    L --> M
    
    M --> N{íƒ€ì´ë° ì •ë³´ ìˆìŒ?}
    N -->|Yes| O[ê°€ë¼ì˜¤ì¼€ ì¤€ë¹„ ì™„ë£Œ]
    N -->|No| P[AI íƒ€ì´ë° ìƒì„±]
    P --> O
    
    O --> Q[OBS ì˜¤ë²„ë ˆì´ ì‹œì‘]
    Q --> R[ìŒì•… ì¬ìƒ ì‹œì‘]
    
    R --> S[ì‹¤ì‹œê°„ ë™ê¸°í™”]
    S --> T{ë™ê¸°í™” ì¡°ì • í•„ìš”?}
    T -->|Yes| U[ì˜¤í”„ì…‹ ì¡°ì • (+/- í‚¤)]
    U --> S
    T -->|No| V[ê°€ë¼ì˜¤ì¼€ ì§„í–‰]
    
    V --> W[ë‹¨ì–´ë³„ í•˜ì´ë¼ì´íŒ…]
    W --> X[ì‹¤ì‹œê°„ ë²ˆì—­ í‘œì‹œ]
    X --> Y{ê³¡ ì¢…ë£Œ?}
    Y -->|No| W
    Y -->|Yes| Z[ë‹¤ìŒ ê³¡ ì¤€ë¹„]
    Z --> C
    
    subgraph "ìë™ LRC íŒŒì´í”„ë¼ì¸"
        AA[Spotify API]
        AB[LRClib.net]
        AC[Genius + AI]
        AD[YouTube ìë§‰]
        AE[Musixmatch]
    end
    
    H --> AA
    H --> AB
    H --> AC
    H --> AD
    H --> AE
```

## 9. ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜

```mermaid
graph TB
    subgraph "Control Panel (Main Window)"
        A[SearchInput] --> B[LRCFetcherManager]
        B --> C[MetadataExtractor]
        C --> D[ProviderOrchestrator]
        D --> E[LRCProviders]
        F[SyncControls] --> G[SyncManager]
        H[StyleEditor] --> I[ThemeManager]
    end
    
    subgraph "OBS Overlay (Browser Source)"
        J[OverlayRenderer] --> K[KaraokeDisplay]
        K --> L[WordHighlighter]
        K --> M[TranslationDisplay]
        N[TimingEngine] --> K
        O[AnimationEngine] --> L
    end
    
    subgraph "Shared State"
        P[WebSocket/BroadcastChannel]
        Q[localStorage]
        R[URL Parameters]
    end
    
    subgraph "External APIs"
        S[Spotify Web API]
        T[YouTube Data API]
        U[LRClib.net API]
        V[Genius API]
        W[Google Translate API]
        X[OpenAI Whisper API]
    end
    
    D --> S
    D --> T
    D --> U
    D --> V
    M --> W
    D --> X
    
    G --> P
    I --> P
    P --> N
    P --> M
    
    B --> Q
    Q --> J
    R --> J
```

## 10. ë°ì´í„° êµ¬ì¡°

```typescript
// ìë™ ê²€ìƒ‰ëœ LRC ìºì‹œ
interface LRCCache {
  [songId: string]: {
    query: SongQuery;
    results: LRCSearchResult[];
    selectedLRC: ParsedLRC;
    source: string;
    confidence: number;
    timestamp: number;
    syncOffset: number;
  }
}

// ì‚¬ìš©ì ì„¤ì •
interface UserSettings {
  // API ì„¤ì •
  apiKeys: {
    google?: string;
    spotify?: string;
    genius?: string;
    openai?: string;
  };
  
  // LRC ì†ŒìŠ¤ ìš°ì„ ìˆœìœ„
  lrcProviders: {
    priority: string[]; // ['spotify', 'lrclib', 'genius', ...]
    enabledProviders: Set<string>;
    autoFallback: boolean;
    useAITiming: boolean;
  };
  
  // ë²ˆì—­ ì„¤ì •
  translation: {
    enabled: boolean;
    targetLanguages: string[];
    cacheEnabled: boolean;
    provider: 'google' | 'deepl' | 'openai';
  };
  
  // ë””ìŠ¤í”Œë ˆì´ ì„¤ì •
  display: {
    theme: 'dark' | 'light' | 'custom';
    fontSize: {
      lyrics: number;
      translation: number;
    };
    colors: {
      background: string;
      text: string;
      highlight: string;
      translation: string;
    };
    animation: {
      wordTransition: 'fade' | 'slide' | 'scale';
      lineTransition: 'fade' | 'slide' | 'bounce';
      highlightStyle: 'fill' | 'underline' | 'glow';
    };
  };
  
  // ë™ê¸°í™” ì„¤ì •
  sync: {
    autoSync: boolean;
    defaultOffset: number;
    savedOffsets: {
      [songId: string]: number;
    };
  };
}

// ì‹¤ì‹œê°„ ìƒíƒœ
interface PlaybackState {
  currentSong: SongQuery;
  lrcData: ParsedLRC;
  currentTime: number;
  currentLine: number;
  currentWord: number;
  offset: number;
  isPlaying: boolean;
  translations: Map<number, string>; // line index -> translated text
}
```

## 11. ì¶”ê°€ ê³ ë ¤ì‚¬í•­

### ğŸ¯ **ì„±ëŠ¥ ìµœì í™”**
- LRC ê²€ìƒ‰ ê²°ê³¼ ìºì‹± (24ì‹œê°„)
- ë²ˆì—­ ê²°ê³¼ ì˜êµ¬ ìºì‹±
- Web Workerì—ì„œ íƒ€ì´ë° ê³„ì‚°
- RequestAnimationFrame ìµœì í™”
- ê°€ìƒ ìŠ¤í¬ë¡¤ë§ (ê¸´ ê°€ì‚¬)

### ğŸ”§ **ì—ëŸ¬ ì²˜ë¦¬**
- LRC ê²€ìƒ‰ ì‹¤íŒ¨ ì‹œ ë‹¤ìŒ í”„ë¡œë°”ì´ë” ìë™ ì‹œë„
- íƒ€ì´ë° ì •ë³´ ì—†ì„ ì‹œ AI ìƒì„± ì œì•ˆ
- ë²ˆì—­ API ì‹¤íŒ¨ ì‹œ ë¡œì»¬ ìºì‹œ ì‚¬ìš©
- ë„¤íŠ¸ì›Œí¬ ì˜¤ë¥˜ ì‹œ ì˜¤í”„ë¼ì¸ ëª¨ë“œ

### ğŸ¨ **ì‚¬ìš©ì ê²½í—˜**
- ë“œë˜ê·¸ ì•¤ ë“œë¡­ LRC ì—…ë¡œë“œ
- ì‹¤ì‹œê°„ ë¯¸ë¦¬ë³´ê¸°
- ë‹¨ì¶•í‚¤ ì§€ì› (Space: ì¬ìƒ/ì •ì§€, â†â†’: ì˜¤í”„ì…‹)
- ìë™ ì €ì¥ ë° ë³µêµ¬
- ë‹¤í¬/ë¼ì´íŠ¸ í…Œë§ˆ ìë™ ì „í™˜

### ğŸŒ **í™•ì¥ì„±**
- í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ (ì»¤ìŠ¤í…€ LRC í”„ë¡œë°”ì´ë”)
- ì»¤ë®¤ë‹ˆí‹° LRC ê³µìœ 
- ë‹¤ì–‘í•œ ì˜¤ë²„ë ˆì´ í…œí”Œë¦¿
- API ë˜í¼ ë¼ì´ë¸ŒëŸ¬ë¦¬ ì œê³µ

### ğŸ”’ **ì €ì‘ê¶Œ ê³ ë ¤**
- LRC ì¶œì²˜ ëª…ì‹œ
- DMCA ì¤€ìˆ˜
- ìƒì—…ì  ì‚¬ìš© ì œí•œ ì•ˆë‚´

## 12. êµ¬í˜„ ìš°ì„ ìˆœìœ„

### Phase 1: MVP (1ì£¼)
1. LRClib.net ì—°ë™ (ë¬´ë£Œ, ê°„ë‹¨)
2. ê¸°ë³¸ ê°€ë¼ì˜¤ì¼€ ë Œë”ë§
3. ìˆ˜ë™ ì˜¤í”„ì…‹ ì¡°ì •
4. Google Translate ì—°ë™
5. OBS ì˜¤ë²„ë ˆì´ í˜ì´ì§€

### Phase 2: ìë™í™” (2ì£¼)
1. YouTube/Spotify ë©”íƒ€ë°ì´í„° ì¶”ì¶œ
2. ë‹¤ì¤‘ LRC ì†ŒìŠ¤ ê²€ìƒ‰
3. ì‹ ë¢°ë„ ê¸°ë°˜ ìë™ ì„ íƒ
4. ë²ˆì—­ ìºì‹±
5. ìŠ¤íƒ€ì¼ ì»¤ìŠ¤í„°ë§ˆì´ì§•

### Phase 3: ê³ ê¸‰ ê¸°ëŠ¥ (3ì£¼)
1. Spotify ê°€ì‚¬ API ë¦¬ë²„ìŠ¤ ì—”ì§€ë‹ˆì–´ë§
2. Whisper API íƒ€ì´ë° ìƒì„±
3. ì˜¤ë””ì˜¤ íŒŒí˜• ë™ê¸°í™”
4. í”ŒëŸ¬ê·¸ì¸ ì‹œìŠ¤í…œ
5. ì»¤ë®¤ë‹ˆí‹° ê¸°ëŠ¥

## 13. ê²°ë¡ 

ë³¸ ì‹œìŠ¤í…œì€ ìˆ˜ë™ LRC ì—…ë¡œë“œì˜ ë²ˆê±°ë¡œì›€ì„ í•´ê²°í•˜ëŠ” ìë™í™”ëœ ê°€ë¼ì˜¤ì¼€ ê°€ì‚¬ ì‹œìŠ¤í…œì´ë‹¤. ë‹¤ì–‘í•œ LRC ì†ŒìŠ¤ë¥¼ ì§€ëŠ¥ì ìœ¼ë¡œ ê²€ìƒ‰í•˜ê³ , ìµœì ì˜ ê²°ê³¼ë¥¼ ìë™ ì„ íƒí•˜ë©°, ì‹¤ì‹œê°„ ë²ˆì—­ê³¼ í•¨ê»˜ ì „ë¬¸ì ì¸ ê°€ë¼ì˜¤ì¼€ ê²½í—˜ì„ ì œê³µí•œë‹¤. OBS ë°©ì†¡ì— ìµœì í™”ëœ íˆ¬ëª… ì˜¤ë²„ë ˆì´ë¡œ ì‹œì²­ìì—ê²Œ ëª°ì…ê° ìˆëŠ” ë…¸ë˜ ë°©ì†¡ì„ ì„ ì‚¬í•  ìˆ˜ ìˆë‹¤.

