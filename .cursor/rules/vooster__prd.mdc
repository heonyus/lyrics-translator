---
description:
globs:
alwaysApply: true
---
# í†µí•©í˜• ì‹¤ì‹œê°„ ë‹¤êµ­ì–´ ìŒì„± ë²ˆì—­ ì‹œìŠ¤í…œ PRD (ë©€í‹° API ì§€ì›)

## 1. í”„ë¡œì íŠ¸ ê°œìš”

- **í”„ë¡œì íŠ¸ ëª…**: í†µí•©í˜• ì‹¤ì‹œê°„ ìŒì„± í†µì—­ ì‹œìŠ¤í…œ
- **ëª©í‘œ**: ì‚¬ìš©ìì˜ í•œêµ­ì–´ ìŒì„±ì„ ì‹¤ì‹œê°„ìœ¼ë¡œ ì¸ì‹í•˜ê³ , ì„ íƒí•œ ë‹¤êµ­ì–´ë¡œ ìì—°ìŠ¤ëŸ½ê²Œ ë²ˆì—­ëœ ìŒì„±ì„ ì¶œë ¥í•˜ëŠ” ì´ˆì €ì§€ì—° ì‹œìŠ¤í…œì„ êµ¬ì¶•í•˜ë©°, ë‹¤ì–‘í•œ ìŒì„± API(STT, ë²ˆì—­, TTS)ë¥¼ ì†ì‰½ê²Œ êµì²´í•˜ê±°ë‚˜ ì¡°í•©í•  ìˆ˜ ìˆë„ë¡ ì„¤ê³„í•œë‹¤.
- **í•µì‹¬ ê¸°ìˆ  ìŠ¤íƒ**: Next.js, TypeScript, Web Audio API, WebSocket, ëª¨ë“ˆí™”ëœ API Adapter êµ¬ì¡° (GPT-4o, Soniox, Google Gemini ë“±)

## 2. í•µì‹¬ ê¸°ëŠ¥ (Features)

- **ëª¨ë“ˆí˜• ìŒì„± ì…ì¶œë ¥ ì²˜ë¦¬**:

  - ë‹¤ì–‘í•œ STT, ë²ˆì—­, TTS APIë¥¼ í”ŒëŸ¬ê·¸ì¸ í˜•íƒœë¡œ ì—°ë™ ê°€ëŠ¥
  - ê¸°ë³¸ê°’ìœ¼ë¡œ GPT-4o Realtime ì‚¬ìš© (STT + ë²ˆì—­ + TTS í†µí•©)
  - í•„ìš” ì‹œ Soniox STT, Google Translate, Google TTS, Gemini TTS ë“±ìœ¼ë¡œ êµì²´ ê°€ëŠ¥

- **ì‹¤ì‹œê°„ ìŒì„± ìŠ¤íŠ¸ë¦¬ë°**:

  - ë¸Œë¼ìš°ì € ë§ˆì´í¬ ìº¡ì²˜ ë° WebRTC/WebSocketì„ í†µí•œ ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ ì²˜ë¦¬
  - ìŒì„± ì…ë ¥ê³¼ ë™ì‹œì— ì‹¤ì‹œê°„ ì‘ë‹µ ì¬ìƒ ê°€ëŠ¥

- **ë‹¤êµ­ì–´ ìˆœì°¨ ì¶œë ¥ ì‹œìŠ¤í…œ**:

  - ë‹¤ì¤‘ ì–¸ì–´ ì„ íƒ ë° ìˆœì„œ ì„¤ì • (ë“œë˜ê·¸ì•¤ë“œë¡­ ì§€ì›)
  - ê° ì–¸ì–´ë³„ ê°œë³„ ON/OFF í† ê¸€ ì œì–´
  - ì„ íƒëœ ì–¸ì–´ë“¤ì˜ ìˆœì°¨ì  ìŒì„± ì¬ìƒ
  - ì–¸ì–´ë³„ ìš°ì„ ìˆœìœ„ ë° ì¬ìƒ ìˆœì„œ ê´€ë¦¬

- **ì–¸ì–´ ì„¤ì • ë° API ì„ íƒ**:

  - ì¶œë ¥ ì–¸ì–´ ë‹¤ì¤‘ ì„ íƒ (ì²´í¬ë°•ìŠ¤ + ìˆœì„œ ì¡°ì •)
  - API ê³µê¸‰ìë³„ ì„¤ì • (ì˜ˆ: GPT-4o, Soniox + Gemini, Google TTS ë“±)
  - ì–¸ì–´ë³„ ìŒì„± í’ˆì§ˆ ë° ì†ë„ ê°œë³„ ì„¤ì •

- **UI ê¸°ëŠ¥**:

  - ë§ˆì´í¬ on/off, ë³¼ë¥¨ ì œì–´
  - ì‹¤ì‹œê°„ í…ìŠ¤íŠ¸ ë¡œê·¸ ì¶œë ¥ (ì›ë¬¸ + ë²ˆì—­ë¬¸)
  - ì„¤ì • ì €ì¥ ë° API í‚¤ ì…ë ¥ ê´€ë¦¬

## 3. IA (í˜ì´ì§€ êµ¬ì¡°ë„)

- **ë©”ì¸ í˜ì´ì§€ (**``**)**:

  - ì‹¤ì‹œê°„ í†µì—­ ì¸í„°í˜ì´ìŠ¤ (ë§ˆì´í¬, ì–¸ì–´ ì„ íƒ, ìŒì„± ë¡œê·¸)

- **ì„¤ì • í˜ì´ì§€ (**``**)**:

  - API ì„¤ì • (STT, ë²ˆì—­, TTS ì„ íƒ)
  - ì¶œë ¥ ì–¸ì–´ ë° ìŒì„± í’ˆì§ˆ ì„¤ì •
  - API í‚¤ ê´€ë¦¬ ë° ì¥ì¹˜ ì„ íƒ

## 4. ë„ë©”ì¸ ì„¤ê³„

`src/domains/` ê¸°ì¤€ìœ¼ë¡œ êµ¬ì„±

- `speech`: ë§ˆì´í¬ ìº¡ì²˜ ë° ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë° ë¡œì§
- `translation`: ë‹¤êµ­ì–´ ë²ˆì—­ ì²˜ë¦¬ ë° ì–¸ì–´ë³„ ê²°ê³¼ ê´€ë¦¬
- `tts`: ìŒì„± í•©ì„± ë° ë‹¤ì¤‘ ì–¸ì–´ ìŒì„± ìƒì„±
- `pipeline`: STT â†’ ë²ˆì—­ â†’ TTS íŒŒì´í”„ë¼ì¸ êµ¬ì„± ë° ì „í™˜ ì²˜ë¦¬
- `queue`: ë‹¤êµ­ì–´ ìŒì„± í ê´€ë¦¬ ë° ìˆœì°¨ ì¬ìƒ ì œì–´
- `api`: ê³µê¸‰ìë³„ ì–´ëŒ‘í„° ëª¨ë“ˆ (`gpt4o.ts`, `soniox.ts`, `gemini.ts`, `google.ts`)
- `settings`: ì‚¬ìš©ì ì„¤ì •, API í‚¤, ì–¸ì–´ ì €ì¥ ë° ìš°ì„ ìˆœìœ„ ê´€ë¦¬
- `ui`: í”„ë¡ íŠ¸ì—”ë“œ ë§ˆì´í¬, ì–¸ì–´ ì„ íƒ, í…ìŠ¤íŠ¸ ì¶œë ¥ ì»´í¬ë„ŒíŠ¸

## 5. ì£¼ìš” ë¡œì§ (ìˆ˜ë„ì½”ë“œ)

```pseudocode
// ë‹¤êµ­ì–´ ìˆœì°¨ ì¶œë ¥ ë©”ì¸ ë¡œì§
function startMultiLanguageTranslationPipeline(enabledLanguages, providerConfig) {
  mic = await startMicrophoneCapture()
  audioQueue = new AudioQueue()

  if (providerConfig.name == 'gpt4o') {
    // GPT-4oëŠ” ë‹¨ì¼ ì–¸ì–´ë§Œ ì§€ì›í•˜ë¯€ë¡œ ì²« ë²ˆì§¸ ì–¸ì–´ ì‚¬ìš©
    primaryLanguage = enabledLanguages[0]
    socket = connectGPT4o(primaryLanguage.code)
    mic.onData(chunk => socket.send(chunk))
    socket.onMessage(audio => playAudio(audio))
  } else {
    sttStream = streamToSTT(providerConfig.stt)
    sttStream.onText(koreanText => {
      processMultiLanguageOutput(koreanText, enabledLanguages, providerConfig)
    })
  }
}

// ë‹¤êµ­ì–´ ë²ˆì—­ ë° ìˆœì°¨ ì¬ìƒ
function processMultiLanguageOutput(koreanText, enabledLanguages, providerConfig) {
  audioQueue.clear()
  
  for (language of enabledLanguages) {
    if (language.isEnabled) {
      translatedText = translateText(koreanText, language.code, providerConfig.translation)
      audioData = synthesizeSpeech(translatedText, language.voice, providerConfig.tts)
      audioQueue.enqueue({
        language: language.code,
        audio: audioData,
        text: translatedText,
        priority: language.priority
      })
    }
  }
  
  audioQueue.playSequentially()
}

// ìˆœì°¨ ì¬ìƒ í ê´€ë¦¬
class AudioQueue {
  constructor() {
    this.queue = []
    this.isPlaying = false
  }
  
  enqueue(audioItem) {
    this.queue.push(audioItem)
    this.queue.sort((a, b) => a.priority - b.priority)
  }
  
  playSequentially() {
    if (this.isPlaying || this.queue.length === 0) return
    
    this.isPlaying = true
    this.playNext()
  }
  
  playNext() {
    if (this.queue.length === 0) {
      this.isPlaying = false
      return
    }
    
    currentAudio = this.queue.shift()
    displayTranslation(currentAudio.language, currentAudio.text)
    
    audioPlayer.play(currentAudio.audio)
    audioPlayer.onEnded(() => this.playNext())
  }
}
```

## 6. API ì‚¬ìš© ë°©ì‹ ìš”ì•½

### ğŸ”¹ GPT-4o Realtime API (í†µí•©í˜• STT+ë²ˆì—­+TTS)

- **ì‚¬ìš© ë°©ì‹**: WebSocket ê¸°ë°˜ ì‹¤ì‹œê°„ ì„¸ì…˜ ìƒì„± í›„ ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¬ë° ì „ì†¡
- **ì„¤ì • ì§€ì¹¨ (**``**)** ì˜ˆì‹œ:

```json
{
  "type": "response.create",
  "response": {
    "modalities": ["audio"],
    "instructions": "Translate from Korean to Japanese and respond only in Japanese speech."
  }
}
```

- **íŠ¹ì§•**: ë‹¨ì¼ ì„¸ì…˜ì—ì„œ ì…ë ¥ëœ ìŒì„±ì„ ë¶„ì„, ë²ˆì—­, ìŒì„± ì¶œë ¥ê¹Œì§€ ìˆ˜í–‰ (ì´ˆì €ì§€ì—°, ìì—°ìŠ¤ëŸ¬ìš´ ì–µì–‘ ìœ ì§€)

### ğŸ”¹ Soniox STT API

- **ì‚¬ìš© ë°©ì‹**: WebSocket ê¸°ë°˜ ì˜¤ë””ì˜¤ ìŠ¤íŠ¸ë¦¼ ì…ë ¥ í›„ í…ìŠ¤íŠ¸ ì‘ë‹µ ìˆ˜ì‹ 
- **URL**: `wss://api.soniox.com/v1/stt/streaming`
- **ìš”ì²­ ì˜ˆì‹œ**:

```json
{
  "access_key": "<SONIOX_API_KEY>",
  "language": "ko-KR",
  "audio_format": "pcm_s16le",
  "sample_rate": 16000
}
```

- **íŠ¹ì§•**: ì •í™•í•œ STT ê²°ê³¼ ì œê³µ, STT ì „ìš© ê³ ì •ë°€ API

### ğŸ”¹ Google Translate API

- **ì‚¬ìš© ë°©ì‹**: HTTP POST ìš”ì²­ìœ¼ë¡œ í…ìŠ¤íŠ¸ ë²ˆì—­
- **Endpoint**: `https://translation.googleapis.com/language/translate/v2`
- **ìš”ì²­ ì˜ˆì‹œ**:

```json
{
  "q": "ì•ˆë…•í•˜ì„¸ìš”",
  "source": "ko",
  "target": "en",
  "format": "text"
}
```

- **íŠ¹ì§•**: ë¹ ë¥´ê³  í’ˆì§ˆ ë†’ì€ ë²ˆì—­, ì–¸ì–´ ì§€ì› í­ë„“ìŒ

### ğŸ”¹ Google TTS API

- **ì‚¬ìš© ë°©ì‹**: HTTP POST ìš”ì²­ìœ¼ë¡œ í…ìŠ¤íŠ¸ â†’ ìŒì„± ìƒì„±
- **Endpoint**: `https://texttospeech.googleapis.com/v1/text:synthesize`
- **ìš”ì²­ ì˜ˆì‹œ**:

```json
{
  "input": { "text": "Hello" },
  "voice": { "languageCode": "en-US", "name": "en-US-Wavenet-D" },
  "audioConfig": { "audioEncoding": "MP3" }
}
```

- **íŠ¹ì§•**: WaveNet ê¸°ë°˜ ìì—°ìŠ¤ëŸ¬ìš´ ë°œìŒ, ì†ë„ ë° ìŒì„± ì œì–´ ê°€ëŠ¥

### ğŸ”¹ Gemini Pro API (TTS / ë²ˆì—­ ê°€ëŠ¥)

- **ì‚¬ìš© ë°©ì‹**: Google AI Studio ë˜ëŠ” Vertex AI ê¸°ë°˜ LLM í˜¸ì¶œ
- **ë²ˆì—­ ì˜ˆì‹œ í”„ë¡¬í”„íŠ¸**: `Translate "ì•ˆë…•í•˜ì„¸ìš”" into English.`
- **TTS ë¯¸ë¦¬ë³´ê¸°**: `tts.speak(text, voiceParams)` ë“± ì‚¬ìš©ì ì •ì˜ API í•„ìš”

## 7. ìœ ì € í”Œë¡œìš° (Mermaid)

```mermaid
graph TD
    A[ì•± ì‹œì‘] --> B[ë§ˆì´í¬ ê¶Œí•œ ìš”ì²­]
    B --> C[ì–¸ì–´ ì„¤ì • í˜ì´ì§€]
    C --> D[ì¶œë ¥ ì–¸ì–´ ë‹¤ì¤‘ ì„ íƒ]
    D --> E[ì–¸ì–´ë³„ ON/OFF í† ê¸€ ì„¤ì •]
    E --> F[ì–¸ì–´ ìš°ì„ ìˆœìœ„ ë“œë˜ê·¸ì•¤ë“œë¡­ ì¡°ì •]
    F --> G[API ì„¤ì • í™•ì¸]
    G --> H[ë©”ì¸ í†µì—­ í™”ë©´]
    H --> I[ë§ˆì´í¬ í™œì„±í™”]
    I --> J[í•œêµ­ì–´ ìŒì„± ì…ë ¥]
    J --> K[ì‹¤ì‹œê°„ STT ì²˜ë¦¬]
    K --> L[í™œì„±í™”ëœ ëª¨ë“  ì–¸ì–´ë¡œ ë™ì‹œ ë²ˆì—­]
    L --> M[ì–¸ì–´ë³„ TTS ìƒì„± ë° í ì¶”ê°€]
    M --> N[ì²« ë²ˆì§¸ ìš°ì„ ìˆœìœ„ ì–¸ì–´ ì¬ìƒ]
    N --> O{ë‹¤ìŒ ì–¸ì–´ê°€ ìˆëŠ”ê°€?}
    O -->|Yes| P[ë‹¤ìŒ ìš°ì„ ìˆœìœ„ ì–¸ì–´ ì¬ìƒ]
    P --> O
    O -->|No| Q[ëª¨ë“  ì–¸ì–´ ì¬ìƒ ì™„ë£Œ]
    Q --> R{ê³„ì† ë§í•˜ëŠ”ê°€?}
    R -->|Yes| J
    R -->|No| S[ëŒ€ê¸° ìƒíƒœ]
    S --> T{ì„¤ì • ë³€ê²½?}
    T -->|Yes| C
    T -->|No| I
    
    subgraph "ì‹¤ì‹œê°„ UI ì—…ë°ì´íŠ¸"
        U[ì›ë¬¸ í…ìŠ¤íŠ¸ í‘œì‹œ]
        V[í˜„ì¬ ì¬ìƒ ì¤‘ì¸ ì–¸ì–´ í•˜ì´ë¼ì´íŠ¸]
        W[ë²ˆì—­ë¬¸ í…ìŠ¤íŠ¸ í‘œì‹œ]
        X[ì¬ìƒ ì§„í–‰ë¥  í‘œì‹œ]
    end
    
    K --> U
    L --> W
    N --> V
    P --> V
    N --> X
    P --> X
```

## 8. ì‹œìŠ¤í…œ ì„¤ê³„ (System Design)

```mermaid
graph TB
  subgraph Client (Browser)
    A[MicCapture.ts] --> B[PipelineManager.ts]
    B --> C[AudioPlayer.ts]
    B --> D[ApiAdapter.ts]
    D --> E[GPT4oAdapter | SonioxAdapter | GeminiAdapter | GoogleAdapter]
  end

  subgraph Settings
    F[localStorage] --> G[SettingsService.ts]
    G --> D
  end

  A --> B
  C --> Speaker
```

## 9. ë°ì´í„° êµ¬ì¡° (ë¡œì»¬ ì €ì¥)

```json
{
  "userSettings": {
    "enabledLanguages": [
      {
        "code": "en",
        "name": "English",
        "isEnabled": true,
        "priority": 1,
        "voice": {
          "provider": "google",
          "name": "en-US-Wavenet-D",
          "speed": 1.0,
          "pitch": 0.0
        }
      },
      {
        "code": "ja",
        "name": "Japanese",
        "isEnabled": true,
        "priority": 2,
        "voice": {
          "provider": "google",
          "name": "ja-JP-Wavenet-A",
          "speed": 1.0,
          "pitch": 0.0
        }
      },
      {
        "code": "zh",
        "name": "Chinese",
        "isEnabled": false,
        "priority": 3,
        "voice": {
          "provider": "google",
          "name": "cmn-CN-Wavenet-A",
          "speed": 1.0,
          "pitch": 0.0
        }
      }
    ],
    "outputVolume": 0.9,
    "playbackMode": "sequential", // "sequential" | "simultaneous"
    "interLanguageDelay": 500, // ms between language playbacks
    "selectedPipeline": {
      "stt": "soniox",
      "translation": "gemini",
      "tts": "google"
    },
    "apiKeys": {
      "openai": "sk-...",
      "soniox": "sx-...",
      "google": "AIza...",
      "gemini": "AIza..."
    },
    "uiPreferences": {
      "showOriginalText": true,
      "showTranslatedText": true,
      "highlightCurrentLanguage": true,
      "showProgressIndicator": true
    }
  }
}
```

## 10. ì¶”ê°€ ê³ ë ¤ì‚¬í•­

### ğŸ¯ **ì„±ëŠ¥ ìµœì í™”**
- ë‹¤ì¤‘ ì–¸ì–´ ë™ì‹œ ë²ˆì—­ ì‹œ API í˜¸ì¶œ ë³‘ë ¬ ì²˜ë¦¬
- ìŒì„± í ë©”ëª¨ë¦¬ ê´€ë¦¬ ë° ê°€ë¹„ì§€ ì»¬ë ‰ì…˜
- ë„¤íŠ¸ì›Œí¬ ì§€ì—° ì‹œ fallback ë©”ì»¤ë‹ˆì¦˜

### ğŸ”§ **ì—ëŸ¬ ì²˜ë¦¬**
- íŠ¹ì • ì–¸ì–´ ë²ˆì—­ ì‹¤íŒ¨ ì‹œ ë‹¤ë¥¸ ì–¸ì–´ëŠ” ê³„ì† ì§„í–‰
- API í˜¸ì¶œ ì‹¤íŒ¨ ì‹œ ì¬ì‹œë„ ë¡œì§
- ë„¤íŠ¸ì›Œí¬ ì—°ê²° ëŠê¹€ ì‹œ ë¡œì»¬ ìºì‹œ í™œìš©

### ğŸ‘¥ **ì‚¬ìš©ì ê²½í—˜**
- ê° ì–¸ì–´ë³„ ì¬ìƒ ìƒíƒœ ì‹œê°ì  í‘œì‹œ
- ì‹¤ì‹œê°„ ë²ˆì—­ ì§„í–‰ë¥  ì¸ë””ì¼€ì´í„°
- ì–¸ì–´ ìˆœì„œ ë³€ê²½ ì‹œ ì¦‰ì‹œ ë¯¸ë¦¬ë³´ê¸°
- í‚¤ë³´ë“œ ë‹¨ì¶•í‚¤ ì§€ì› (ìŠ¤í˜ì´ìŠ¤ë°”: ë§ˆì´í¬ í† ê¸€ ë“±)

### â™¿ **ì ‘ê·¼ì„±**
- ì‹œê° ì¥ì• ì¸ì„ ìœ„í•œ ìŠ¤í¬ë¦° ë¦¬ë” ì§€ì›
- ì²­ê° ì¥ì• ì¸ì„ ìœ„í•œ í…ìŠ¤íŠ¸ í¬ê¸° ì¡°ì ˆ
- ìŒì„± ì†ë„ ë° ë³¼ë¥¨ ì„¸ë°€ ì¡°ì •
- ê³ ëŒ€ë¹„ ëª¨ë“œ ë° ë‹¤í¬ í…Œë§ˆ ì§€ì›

### ğŸ”’ **ë³´ì•ˆ ë° í”„ë¼ì´ë²„ì‹œ**
- API í‚¤ ì•”í˜¸í™” ì €ì¥
- ìŒì„± ë°ì´í„° ë¡œì»¬ ì²˜ë¦¬ ì˜µì…˜
- ì‚¬ìš©ì ë°ì´í„° ìë™ ì‚­ì œ ì„¤ì •

## 11. ê²°ë¡ 

ë³¸ ì‹œìŠ¤í…œì€ ë‹¤ì–‘í•œ ìŒì„±/ë²ˆì—­ APIë¥¼ ììœ ë¡­ê²Œ ì¡°í•©í•˜ì—¬ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ” ìœ ì—°í•œ êµ¬ì¡°ë¡œ ì„¤ê³„ë˜ì–´ ìˆìœ¼ë©°, ë‹¤êµ­ì–´ ìˆœì°¨ ì¶œë ¥ ê¸°ëŠ¥ì„ í†µí•´ ì‹¤ìš©ì ì¸ ì‹¤ì‹œê°„ í†µì—­ ê²½í—˜ì„ ì œê³µí•œë‹¤. ì´ˆê¸°ì—ëŠ” GPT-4o Realtime APIë¥¼ ê¸°ë³¸ ì œê³µí•˜ë˜, Soniox + Gemini + Google ì¡°í•©ìœ¼ë¡œ ì‰½ê²Œ ì „í™˜ ê°€ëŠ¥í•˜ë©°, ì‚¬ìš©ìì˜ ì–¸ì–´ ì„ íƒê³¼ ìš°ì„ ìˆœìœ„ì— ë”°ë¥¸ ë§ì¶¤í˜• í†µì—­ ì„œë¹„ìŠ¤ë¥¼ êµ¬í˜„í•œë‹¤. ì¥ê¸°ì ìœ¼ë¡œ Whisper, Azure Speech, Amazon Polly ë“± ë‹¤ë¥¸ API ëª¨ë¸ë“¤ë„ í”ŒëŸ¬ê·¸ì¸ í˜•íƒœë¡œ í™•ì¥í•  ìˆ˜ ìˆë‹¤.


